
## Setup

```{r setup, include = FALSE}
library(tidyverse)
draft_players <- read.csv("nbaplayersdraft.csv") # load data
draft_players <- draft_players |>
  mutate(college = ifelse(college == "", "No college", college)) # set blank college input to "No college"
draft_players$years_active[is.na(draft_players$years_active)] <- 0 # set NA in years active to 0
draft_players$value_over_replacement[is.na(draft_players$value_over_replacement)] <- 0 # set NA in VORP to 0
```


```{r filtering-function}
get_players_picked_year <- function(df, season) { # function for extracting players drafted from "season"
  if (!(season %in% c(1989:2021))) {
    stop("No information for this season (yet)") # throw error if season entry isn't valid
  }

  players_from_year <- df |>
    filter(year == season) # filter player data frame by draft year

  return(players_from_year) # return filtered data frame
}
```


## Introduction and Data
  Every year, the NBA draft, and the weeks of speculation leading up to it, acts as a major point of focus for basketball fans after the season has ended. Mock drafts are released by experts, draft trades are discussed, and the discussion over whether the draft was indeed a "good" one in terms of talent available becomes a major topic of debate even months before and after draft night (for example, many are already deeming the 2024 class to be one of the weakest ever). The purpose of this project is thus to create an interactive app to allow the user to look at different drafts and come to their own conclusion, in hindsight, whether the draft was deep in talent, what teams came out of draft night the most well-equipped for the future, and what players from that draft year had the most successful careers in the NBA. 
  
  This app, made in Shiny, allows the user to select a draft year and be presented with a list of players taken that year, along with visualizations showing distributions of career value over replacement player (VORP, a statistic used to evaluate how much value a player has provided to their team relative to a standardized "replacement-level" player), number of seasons played by players in that draft, and career VORP added in the draft by each team. Furthermore, a table displays shwoing the top 5 players taken from that draft by VORP. Finally, the players from the list of drafted players can be clicked, displaying a modal dialog box that shows more information about the player (such as their career VORP, the team that drafted them, and the number of years they played in the NBA). 
  
  The data used for this project is in a data set called nbaplayersdraft.csv, with 1922 rows and 24 columns, collected from [Matt OP on Kaggle](https://www.kaggle.com/datasets/mattop/nba-draft-basketball-player-data-19892021). In this data frame, each row is a player taken in the NBA draft between 1989 and 2021, with columns such as player name, draft year, college, career VORP, years active in the NBA, overall pick, and the team the player was selected by being relevant for this project. Players who had a blank entry for their college were made to have "no college" as their entry, while those with missing valuers for years in the NBA and career VORP were modified to have 0 for those values. It is important to note that a player who doesn't make the NBA doesn't have 0 VORP; they don't have a VORP score at all, and in fact many players who made the NBA also had 0 VORP. However, for the purpose of this project, 0 VORP is appropriate for players who did not make the NBA, since they provided no value to the team in that draft. 

## Methods / Implementation
  The first step was importing the data (in this .qmd file), and cleaning the dataset as described above. Next, the function that would be used in the app, get_players_picked_year(), was created, which takes the players dataset and a draft season as inputs. First, the function throws an error if the season input has no data in the dataset (currently, only between 1989 and 2021). Next, the function takes the players dataset and filters by the draft season the player inputs. The function then returns the filtered dataframe, with only the players drafted in that specific season and all the columns. 
  
  Next, in basketballApp.R, the Shiny App showing the draft season information was created. First, I used source() and purl() to import the get_players_picked_year() function from project.qmd. Next, for the UI portion of the Shiny App, I created a title for the App ("NBA Draft Players and Outcomes (1989-2021)"). In the sidebar panel, there is a text input for the user for the draft season they want to explore (with 2003 being the default, because that draft was historically awesome), as well as an action button that retrieves the information for that draft once pressed. The sidebar panel will also display a UI output of the names of the players taken in that season's draft. In the main panel, I used fluidRow() and column() to output the VORP, active years, and team draft success plots, as well as the top-5 players table, all in one column. 
  
  In the server portion of the Shiny App, I use eventReactive() to create a reactive dataframe of the players drafted in the season input by the user, filtered using the get_players_picked_year() function. This dataframe is only created once the Find Players action button is pressed. Next, in the UI output on the sidebar panel, I used renderUI to select just the names of the players from that draft year in the reactive dataset, and used map() on this list of players to create a clickable action link on each of their names. Thus, on the sidebar panel there is a list of players drafted from that year, with clickable action links on their names. After this, I used observe() to create an observer so that a modal dialog box opens up upon clicking the action links. I used lapply() to create a modal dialog box for (using showModal(modalDialog(...))) for each of the action links, where the title of the box displays the name and college of the player, and the contents of the box include the overall pick of the player in the draft, the team that selected them, their total number of seasons in the NBA, and their total career VORP. I used the HTML function to turn the R linebreaks into HTML linebreaks, since this woudl allow all the information in the dialog boxes to be on different lines and thus would be more visually appealing and clear. paste() was also used so that the user input for year was present in this information. Finally, the parameter easyClose was set to TRUE so that the modal dialog box for each player could be closed by clicking anywhere. 
  
  For the plots output by the action button, first I created a histogram of career VORP for players in the draft selected by the user. This was done using ggplot(), with career VORP on the x-axis and count on the y-axis, with a minimal theme and the whole histogram colored green. The title of this visualization also depends on the year input by the user, and changes accordingly. The second visualization, placed directly under the first one, is exactly the same, except it shows a histogram of active years in the NBA for players selected in that draft, and is colored dark red instead. The title for this plot also depends on the user input for season. The third visualization is a bar graph, with team on the x-axis and total VORP added from the user input's draft, used to show which teams ended up drafting the most value from that particular draft. To achieve this, the reactive player dataframe was grouped by team, and the sum of the career VORP added by each team from the players selected in that draft is calculated using summarize(), saved as "total_vorp". A bar graph is then created, with team on the y-axis and total VORP added by that team on the x-axis. To make it so that the teams were ordered by most to least VORP added on the plot, a fct_reorder() was used in the ggplot() to order the teams by VORP. This plot was made completely blue using scale_fill_manual(), with a minimal theme, and once again the title of the plot depends on the user's season input. This plot was placed directly beneath the years active plot. 
  
  Finally, an output table showing the top 5 players from that years draft by VORP is displayed at the bottom upon clicking the action button. To do this, I used observeEvent() so the table pops up when the button is clicked, and used renderTable() to render the table, in which the players data set was  arranged from most VORP to least VORP, information about the name, pick number, selecting team, and career VORP selected, and keeping the top 5 using head(). rename() was used on these selected columns so the output of the table had nicely-formatted and named columns. Thus, when the action button is clicked after the user selects a year, the top 5 most valuable players selected in that draft are displayed at the bottom. 

## Discussion & Conclusion
  One of the reasons I wanted to undertake this type of project was to evaluate what good "value" picks have happened over the NBA Draft's history. These are picks that may have not been taken very high in the draft, but ended up being valuable later on. One major example of this was in the 2014 Draft, in which Nikola Jokic was picked 41st overall but currently has twice as much career VORP as the next-best player from that draft (Joel Embiid). I also wanted to see which teams indeed had the "best draft nights", something that is talked about ad nauseam immediately following the draft. The plot displaying the total career VORP drafted by team displays this well, but it moreso tracks the teams' eye for talent and some luck, since many of the most-valuable players ended up earning most of their VORP for teams that didn't draft them (such as Kobe Bryant in 1996). The histogram of years active in the NBA is best for inter-draft comparison, as comparing between drafts makes no sense since players from earlier drafts obviously have more opportunities to play longer than those from newer drafts. Something similar can be said for the VORP plot, though there are clear years that have had players with better careers than others (such as the aforementioned 2003, with 4 hall of famers and US gold medalists taken in the top 5). Unfortunately, this dataset only had data from players drafted between 1989 and 2021, but I plan on expanding on this in future updated by incorporating new datasets to account for the missing years. 
  
